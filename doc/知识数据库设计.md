# 知识数据库设计

## 概述

本文档描述了AI教师应用中知识数据库的设计和实现。知识数据库用于存储教学知识点和题目信息，支持数学、语文、英语等学科的教学需求。

## 数据库结构

### 实体类

#### KnowledgeEntity（知识点实体）
对应知识库表(KnowledgeBase)，包含以下字段：

- `knowledgeId`: String (主键) - 知识点ID，如 "M7-001"
- `subject`: String - 学科，如 "数学"
- `grade`: Int - 年级，如 7
- `chapter`: String - 章节，如 "有理数"
- `concept`: String - 概念描述
- `applicationMethods`: List<String> - 应用方法列表
- `keywords`: List<String> - 关键词列表

#### QuestionEntity（题目实体）
对应题库表(QuestionBase)，包含以下字段：

- `questionId`: String (主键) - 题目ID，如 "Q1001"
- `subject`: String - 学科，如 "数学"
- `grade`: Int - 年级，如 7
- `questionText`: String - 题目内容
- `answer`: String - 答案
- `questionType`: String - 题目类型，如 "单选题"
- `difficulty`: Int - 难度等级
- `relatedKnowledgeIds`: List<String> - 关联的知识点ID列表

### 数据访问对象 (DAO)

#### KnowledgeDao
提供以下数据访问方法：

1. `getKnowledgeById(knowledgeId: String)`: 根据知识点ID获取知识点
2. `getKnowledgeBySubjectAndGrade(subject: String, grade: Int)`: 根据学科和年级获取知识点
3. `getKnowledgeByChapter(chapter: String)`: 根据章节获取知识点
4. `getAllKnowledge()`: 获取所有知识点
5. `insertKnowledge(knowledge: KnowledgeEntity)`: 插入知识点
6. `insertAllKnowledge(knowledgeList: List<KnowledgeEntity>)`: 批量插入知识点
7. `updateKnowledge(knowledge: KnowledgeEntity)`: 更新知识点
8. `deleteKnowledgeById(knowledgeId: String)`: 根据知识点ID删除知识点

#### QuestionDao
提供以下数据访问方法：

1. `getQuestionById(questionId: String)`: 根据题目ID获取题目
2. `getQuestionsBySubjectAndGrade(subject: String, grade: Int)`: 根据学科和年级获取题目
3. `getQuestionsByType(questionType: String)`: 根据题目类型获取题目
4. `getQuestionsByDifficulty(difficulty: Int)`: 根据难度获取题目
5. `getQuestionsByKnowledgeId(knowledgeId: String)`: 根据知识点ID获取相关题目
6. `getAllQuestions()`: 获取所有题目
7. `insertQuestion(question: QuestionEntity)`: 插入题目
8. `insertAllQuestions(questions: List<QuestionEntity>)`: 批量插入题目
9. `updateQuestion(question: QuestionEntity)`: 更新题目
10. `deleteQuestionById(questionId: String)`: 根据题目ID删除题目

### 仓库类

#### KnowledgeRepository
知识点仓库类，提供业务逻辑层接口：

1. `getKnowledgeById(...)`: 获取知识点
2. `getKnowledgeBySubjectAndGrade(...)`: 根据学科和年级获取知识点
3. `getKnowledgeByChapter(...)`: 根据章节获取知识点
4. `getAllKnowledge()`: 获取所有知识点
5. `insertKnowledge(...)`: 添加知识点
6. `insertAllKnowledge(...)`: 批量添加知识点
7. `updateKnowledge(...)`: 更新知识点
8. `deleteKnowledge(...)`: 删除知识点

#### QuestionRepository
题目仓库类，提供业务逻辑层接口：

1. `getQuestionById(...)`: 获取题目
2. `getQuestionsBySubjectAndGrade(...)`: 根据学科和年级获取题目
3. `getQuestionsByType(...)`: 根据题目类型获取题目
4. `getQuestionsByDifficulty(...)`: 根据难度获取题目
5. `getQuestionsByKnowledgeId(...)`: 根据知识点ID获取相关题目
6. `getAllQuestions()`: 获取所有题目
7. `insertQuestion(...)`: 添加题目
8. `insertAllQuestions(...)`: 批量添加题目
9. `updateQuestion(...)`: 更新题目
10. `deleteQuestion(...)`: 删除题目

## 使用示例

### 创建知识点

```kotlin
val knowledge = KnowledgeEntity(
    knowledgeId = "M7-001",
    subject = "数学",
    grade = 7,
    chapter = "有理数",
    concept = "有理数是可以表示为两个整数之比的数，即形如 a/b（b≠0）的数。",
    applicationMethods = listOf(
        "比较大小：通分后比较分子",
        "加减法：先通分，再运算"
    ),
    keywords = listOf("有理数", "分数", "整数比")
)

val result = knowledgeRepository.insertKnowledge(knowledge)
```

### 创建题目

```kotlin
val question = QuestionEntity(
    questionId = "Q1001",
    subject = "数学",
    grade = 7,
    questionText = "下列哪个数是有理数？A. √2  B. π  C. 3/4  D. e",
    answer = "C",
    questionType = "单选题",
    difficulty = 2,
    relatedKnowledgeIds = listOf("M7-001")
)

val result = questionRepository.insertQuestion(question)
```

### 查询知识点和题目

```kotlin
// 根据知识点ID获取知识点
val knowledge = knowledgeRepository.getKnowledgeById("M7-001")

// 根据学科和年级获取知识点
val knowledgeList = knowledgeRepository.getKnowledgeBySubjectAndGrade("数学", 7)

// 根据知识点ID获取相关题目
val questions = questionRepository.getQuestionsByKnowledgeId("M7-001")
```

## 数据库集成

知识数据库已集成到现有的 `AITeacherDatabase` 中，与学生数据库和用户数据库共存。数据库版本保持为1，新增了 `knowledge_base` 和 `question_base` 表。

## 类型转换器

由于Room数据库不直接支持List类型，我们实现了 `Converters` 类来处理List<String>类型的字段转换，使用Gson进行序列化和反序列化。

## 测试

提供了 `KnowledgeDatabaseTest` 测试类，用于验证知识数据库的基本功能，包括创建和查询知识点和题目的功能。