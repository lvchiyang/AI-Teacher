# 用户数据库设计

## 概述

本文档描述了AI教师应用中用户数据库的设计和实现。用户数据库用于存储应用中的用户信息，包括家长和学生两种类型的用户。

## 数据库结构

### 实体类

#### UserEntity
用户数据库实体，包含以下字段：

- `userId`: String (主键) - 用户唯一标识符
- `userType`: UserType - 用户类型（家长或学生）
- `studentId`: String? - 学生ID（仅学生用户有效）
- `studentName`: String? - 学生姓名（仅学生用户有效）
- `grade`: Int? - 年级（仅学生用户有效）
- `currentChapter`: String? - 当前学习章节（仅学生用户有效）

#### UserType 枚举
用户类型枚举，包含以下值：
- `PARENT`: 家长用户
- `STUDENT`: 学生用户

### 数据访问对象 (DAO)

#### UserDao
提供以下数据访问方法：

1. `getUserById(userId: String)`: 根据用户ID获取用户信息
2. `getUsersByType(userType: UserType)`: 根据用户类型获取用户列表
3. `getAllUsers()`: 获取所有用户
4. `insertUser(user: UserEntity)`: 插入或更新用户
5. `updateUser(user: UserEntity)`: 更新用户信息
6. `deleteUser(user: UserEntity)`: 删除用户
7. `deleteUserById(userId: String)`: 根据用户ID删除用户

### 仓库类

#### UserRepository
用户仓库类，提供业务逻辑层接口：

1. `createUser(...)`: 创建新用户
2. `getUserById(...)`: 获取用户信息
3. `updateUser(...)`: 更新用户信息
4. `deleteUser(...)`: 删除用户
5. `getUsersByType(...)`: 根据类型获取用户
6. `getAllUsers(...)`: 获取所有用户

## 使用示例

### 创建学生用户

```kotlin
val student = Student(
    studentId = "student_001",
    studentName = "张三",
    grade = 7,
    currentChapter = "第一章 有理数",
    learningProgress = LearningProgress(...)
)

val result = userRepository.createUser(
    userId = "user_001",
    userType = UserType.STUDENT,
    studentInfo = student
)
```

### 创建家长用户

```kotlin
val result = userRepository.createUser(
    userId = "parent_001",
    userType = UserType.PARENT
)
```

### 查询用户

```kotlin
val user = userRepository.getUserById("user_001")
when (user?.userType) {
    UserType.STUDENT -> {
        // 处理学生用户逻辑
        println("学生姓名: ${user.studentName}")
    }
    UserType.PARENT -> {
        // 处理家长用户逻辑
        println("这是一个家长用户")
    }
    null -> {
        println("用户不存在")
    }
}
```

## 数据库集成

用户数据库已集成到现有的 `AITeacherDatabase` 中，与学生数据库共存。数据库版本保持为1，新增了 `users` 表。

## 测试

提供了 `UserDatabaseTest` 测试类，用于验证用户数据库的基本功能，包括创建和查询不同类型用户的功能。