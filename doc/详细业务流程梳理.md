先一切从简，重点实现核心功能。
初始界面，选择年级，选择开始的章节。

核心数据结构：
需要记录当前学生掌握情况，一个想法是在教学大纲的基础上，记录学生对每个章节掌握情况，也就是这个学生的专属教学大纲，后面称为“生纲”。所有Agent都可以看到这个大纲，教秘据此设计教学任务，教师更新记录教学进度，检验记录更新学生掌握情况。每一个知识点有：未讲解、已讲解待复习、未掌握、初步掌握、熟练掌握，几个阶段，分别对应不同学习任务，在不同阶段被更新。

教秘业务流程：
教秘Agent根据生纲，制定教学计划（要复习的知识点、新教知识点），到教学资料中去索引对应章节知识点，作为本节课的知识库（包括学生需要复习的知识点和要继续学习的知识点）；

教师Agent业务流程：
根据教秘的教学任务，首先将任务拆分逐步实现，按本节课知识点，循环进行下面的任务；

讲解每一个知识点的流程：
1. 查看当前要讲解的知识点，判断本节课任务是否完成，判断当前知识点学生是否掌握；
    a. 调用大模型创建ppt/图片，讲解知识点；
    b. 文本大模型生成针对当前知识点，生成教学文本，先讲解，然后设置对应问题；
    c. 语音模型将文本读出来，向学生提问；
    d. 等待学生回答\询问，分析是否正确，如果不正确则连同学生回答，返回b；正确则标志当前知识点以完成教学；不回答则记录，若学生不回答次数超过3，则向父母手机推送消息；

教师完成本节课所有复习和教学任务，到检验Agent流程：
1. 查看本节课所有知识点、教学大纲中标记学生仍掌握不好的知识点，到数据库中搜索对应母题；
2. 调用大模型出题，然后逐题进行一下流程；

1. 调用大模型，创建题目图片，显示在前端；
2. 按照题目分值给学生时间解题，学生可以提前交卷，超过时间则继续做题意义不大，触发讲解；
3. 若学生给出答案，调用大模型识别学生做题结果。
4. 若学生正确做题，如果的付费用户，大模型检查有无更好解题方法，生成做题步骤；如果普通用户，则进入下一题；
    a. 触发讲题循环，生成讲解文档，并语音输出。识别学生问题、反馈，反复沟通，直到模型确认学生掌握本题知识点。
5. 在大纲上更新当前知识点进度。



教秘如何设计本节课教学大纲内容？
1. 知识库检索，获得当前年级所有知识点；
2. 获得这个学生的LearningProgress，prompt中说明taughtToReview、notMastered是首先要进行复习的知识点；获取这个学生当前学习章节，prompt说明，这个章节是本节课新学习的内容。

让模型输出本节课复习+学习的大纲内容，返回一个结构体列表，作为本节课要讲解的知识点；


教师Agent： 知识点的教学是一个反复迭代的过程，需要设计流程来实现这个过程。
最小循环run_once就是Agent单次流程，不能拆这个，而是在其基础上再设计流程！是设计各个Agent的run_loop。一个Agent更像是类的概念，是这个类提供什么功能，被包装在这个类的里面。
父类base_agent提供基本能力（run_once、上下文管理、工具管理），子类教师Agent需要实现教学的函数。
突然发现MCP分两种，一种是Agent内部，llm不需要和外界交互，全自动循环调用的。另一类是需要和用户进行交互，不直接进入循环。

教师Agent需要两层loop，输入的是知识点列表，外层loop是for循环讲解所有知识点，进入到小循环，完成具体知识点的教学，直到模型通过学生反馈认为学生已经掌握知识点的概念。

    先循环判断当前知识点讲解标志位，不是true代表学生已理解，就一直在循环，另外设置一个最大循环次数，知识点讲解循环的内部：
        根据之前的山下文、当前要讲解的知识点，调用run_once，检查大模型输出是否返回教学结束标志，如果是的话break结束当前循环。
        如果不是，将信息输出到前端。前端需要用户输入，使用.add_memory保存用户输入。






如何更新LearningProgress？
设计不同知识点的更新逻辑
/**
 * 学习进度模型
 * 按掌握状态分类记录知识点
 */
data class LearningProgress(
    val taughtToReview: List<String>,        // 已讲解待复习的知识点ID列表  教师Agent完成教学，将讲完的知识点计入
    val notMastered: List<String>,            // 未掌握的知识点ID列表 检验Agent负责更新，当前知识点的题做错了，将这个知识点计入这里 
    val basicMastery: List<String>,           // 初步掌握的知识点ID列表 检验Agent负责更新，知识点的题做对了一次
    val fullMastery: List<String>,            // 熟练掌握的知识点ID列表 检验Agent负责更新，知识点的题做对了两次
    val lastUpdateTime: String                // 最后更新时间
)

Agent就是大模型的函数设计


我得先能看懂这个安卓项目，然后才能知道Agent的代码应该放到哪里。

你先了解一下项目架构，这个一个muti-agents的安卓应用，现在我已经实现了基础了ui也业务逻辑层，现在需要将AI Agent添加到现有业务流当中。
具体来说，你知道当前安卓实现，代码是为了实现业务，清楚业务。